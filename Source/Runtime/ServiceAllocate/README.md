# ServiceAllocate æœåŠ¡åˆ†é…å™¨

## æ¦‚è¿°

ServiceAllocate æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„å¾®æœåŠ¡åˆ†é…å™¨ï¼Œè´Ÿè´£ç®¡ç†æ¸¸æˆæœåŠ¡å™¨é›†ç¾¤ä¸­çš„æœåŠ¡æ³¨å†Œã€å‘çŽ°ã€è´Ÿè½½å‡è¡¡å’Œå¥åº·æ£€æŸ¥ã€‚

## æ ¸å¿ƒåŠŸèƒ½

### ðŸŽ¯ æœåŠ¡æ³¨å†Œä¸Žå‘çŽ°
- æ”¯æŒåŠ¨æ€æœåŠ¡æ³¨å†Œå’Œæ³¨é”€
- æŒ‰æœåŠ¡ç±»åž‹è¿›è¡ŒæœåŠ¡å‘çŽ°
- è‡ªåŠ¨ç»´æŠ¤æœåŠ¡ç´¢å¼•

### âš–ï¸ è´Ÿè½½å‡è¡¡
- åŸºäºŽè´Ÿè½½çš„æœåŠ¡é€‰æ‹©ç­–ç•¥
- æ”¯æŒå¤šç§è´Ÿè½½å‡è¡¡ç®—æ³•
- å®žæ—¶è´Ÿè½½ç›‘æŽ§å’Œæ›´æ–°

### ðŸ¥ å¥åº·æ£€æŸ¥
- è‡ªåŠ¨å¥åº·çŠ¶æ€ç›‘æŽ§
- å¿ƒè·³è¶…æ—¶æ£€æµ‹
- ä¸å¥åº·æœåŠ¡è‡ªåŠ¨éš”ç¦»

### ðŸ“Š é…ç½®ç®¡ç†
- çµæ´»çš„é…ç½®æ–‡ä»¶æ”¯æŒ
- è¿è¡Œæ—¶é…ç½®æ›´æ–°
- å¤šçº§é…ç½®ç®¡ç†

## æž¶æž„è®¾è®¡

```
ServiceAllocate
â”œâ”€â”€ ServiceAllocateManager    # æ ¸å¿ƒç®¡ç†å™¨
â”œâ”€â”€ ConfigManager            # é…ç½®ç®¡ç†
â”œâ”€â”€ Logger                   # æ—¥å¿—ç³»ç»Ÿ
â””â”€â”€ æµ‹è¯•ç¨‹åº                 # åŠŸèƒ½éªŒè¯
```

## å¿«é€Ÿå¼€å§‹

### 1. ç¼–è¯‘æœåŠ¡
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
python BuildSystem/BuildScripts/BuildEngine.py build ServiceAllocate
```

### 2. è¿è¡ŒæœåŠ¡
```bash
# è¿è¡Œä¸»æœåŠ¡
./Build/ServiceAllocateMain

# è¿è¡Œæµ‹è¯•ç¨‹åº
./Build/ServiceAllocateTest
```

### 3. é…ç½®è¯´æ˜Ž

é…ç½®æ–‡ä»¶ï¼š`Configs/ServiceAllocateConfig.json`

```json
{
    "service_name": "ServiceAllocate",
    "listen_port": 50052,
    "log_level": "info",
    "health_check_interval": 30,
    "heartbeat_timeout": 60,
    "max_retries": 3,
    "max_services_per_type": 10,
    "load_balance_strategy": "least_load"
}
```

## API ä½¿ç”¨ç¤ºä¾‹

### æœåŠ¡æ³¨å†Œ
```cpp
ServiceInfo serviceInfo;
serviceInfo.serviceName = "PlayerService-1";
serviceInfo.serviceType = "PlayerService";
serviceInfo.host = "192.168.1.100";
serviceInfo.port = 50051;
serviceInfo.currentLoad = 0;
serviceInfo.maxLoad = 100;
serviceInfo.isHealthy = true;

serviceManager->RegisterService(serviceInfo);
```

### æœåŠ¡åˆ†é…
```cpp
auto result = serviceManager->AllocateService("PlayerService", "Client-123");
if (result.success) {
    std::cout << "åˆ†é…åˆ°æœåŠ¡: " << result.serviceName 
              << " (" << result.host << ":" << result.port << ")" << std::endl;
}
```

### æœåŠ¡å‘çŽ°
```cpp
auto services = serviceManager->GetServicesByType("PlayerService");
for (const auto& service : services) {
    std::cout << "æœåŠ¡: " << service.serviceName 
              << " è´Ÿè½½: " << service.currentLoad << "/" << service.maxLoad << std::endl;
}
```

## è´Ÿè½½å‡è¡¡ç­–ç•¥

### æœ€å°‘è´Ÿè½½ç­–ç•¥ (least_load)
- é€‰æ‹©å½“å‰è´Ÿè½½æœ€ä½Žçš„æœåŠ¡
- é€‚åˆå¤§å¤šæ•°åœºæ™¯
- è‡ªåŠ¨é¿å…è¿‡è½½æœåŠ¡

### è½®è¯¢ç­–ç•¥ (round_robin)
- æŒ‰é¡ºåºåˆ†é…æœåŠ¡
- è´Ÿè½½åˆ†å¸ƒå‡åŒ€
- é€‚åˆæœåŠ¡æ€§èƒ½ç›¸è¿‘çš„åœºæ™¯

## å¥åº·æ£€æŸ¥æœºåˆ¶

### å¿ƒè·³æ£€æµ‹
- æœåŠ¡å®šæœŸå‘é€å¿ƒè·³ä¿¡å·
- è¶…æ—¶è‡ªåŠ¨æ ‡è®°ä¸ºä¸å¥åº·
- å¯é…ç½®å¿ƒè·³é—´éš”å’Œè¶…æ—¶æ—¶é—´

### è‡ªåŠ¨æ¢å¤
- æœåŠ¡é‡æ–°å‘é€å¿ƒè·³åŽè‡ªåŠ¨æ¢å¤
- æ”¯æŒæ‰‹åŠ¨å¥åº·çŠ¶æ€æ›´æ–°
- å®žæ—¶ç›‘æŽ§æœåŠ¡çŠ¶æ€

## æ€§èƒ½ç‰¹æ€§

- **é«˜å¹¶å‘æ”¯æŒ**ï¼šçº¿ç¨‹å®‰å…¨è®¾è®¡ï¼Œæ”¯æŒå¤šçº¿ç¨‹å¹¶å‘è®¿é—®
- **ä½Žå»¶è¿Ÿ**ï¼šå†…å­˜ä¸­çš„æœåŠ¡ç´¢å¼•ï¼Œå¿«é€ŸæŸ¥æ‰¾å’Œåˆ†é…
- **é«˜å¯ç”¨æ€§**ï¼šè‡ªåŠ¨æ•…éšœæ£€æµ‹å’Œæ¢å¤
- **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒåŠ¨æ€æ·»åŠ å’Œç§»é™¤æœåŠ¡

## ç›‘æŽ§å’Œæ—¥å¿—

### æ—¥å¿—çº§åˆ«
- `DEBUG`ï¼šè¯¦ç»†è°ƒè¯•ä¿¡æ¯
- `INFO`ï¼šä¸€èˆ¬ä¿¡æ¯
- `WARN`ï¼šè­¦å‘Šä¿¡æ¯
- `ERROR`ï¼šé”™è¯¯ä¿¡æ¯

### å…³é”®æŒ‡æ ‡
- æœåŠ¡æ³¨å†Œæ•°é‡
- æœåŠ¡åˆ†é…æˆåŠŸçŽ‡
- å¹³å‡å“åº”æ—¶é—´
- å¥åº·æœåŠ¡æ¯”ä¾‹

## éƒ¨ç½²å»ºè®®

### å•æœºéƒ¨ç½²
- é€‚åˆå°è§„æ¨¡é›†ç¾¤
- ç®€å•é…ç½®å’Œè¿ç»´
- å•ç‚¹æ•…éšœé£Žé™©

### é›†ç¾¤éƒ¨ç½²
- å¤šå®žä¾‹è´Ÿè½½å‡è¡¡
- é«˜å¯ç”¨æ€§ä¿è¯
- éœ€è¦é¢å¤–çš„åè°ƒæœºåˆ¶

## æ•…éšœæŽ’é™¤

### å¸¸è§é—®é¢˜

1. **æœåŠ¡åˆ†é…å¤±è´¥**
   - æ£€æŸ¥ç›®æ ‡æœåŠ¡ç±»åž‹æ˜¯å¦å­˜åœ¨
   - ç¡®è®¤æœåŠ¡å¥åº·çŠ¶æ€
   - éªŒè¯è´Ÿè½½æ˜¯å¦è¶…é™

2. **å¿ƒè·³è¶…æ—¶**
   - æ£€æŸ¥ç½‘ç»œè¿žæŽ¥
   - è°ƒæ•´å¿ƒè·³é—´éš”é…ç½®
   - ç¡®è®¤æœåŠ¡æ­£å¸¸è¿è¡Œ

3. **æ€§èƒ½é—®é¢˜**
   - ç›‘æŽ§æœåŠ¡æ•°é‡
   - æ£€æŸ¥è´Ÿè½½åˆ†å¸ƒ
   - ä¼˜åŒ–é…ç½®å‚æ•°

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„è´Ÿè½½å‡è¡¡ç­–ç•¥
1. åœ¨ `ServiceAllocateManager` ä¸­æ·»åŠ æ–°çš„é€‰æ‹©ç®—æ³•
2. æ›´æ–°é…ç½®æ”¯æŒ
3. æ·»åŠ ç›¸åº”çš„æµ‹è¯•ç”¨ä¾‹

### é›†æˆå¤–éƒ¨ç›‘æŽ§ç³»ç»Ÿ
1. å®žçŽ°ç›‘æŽ§æŽ¥å£
2. æ·»åŠ æŒ‡æ ‡æ”¶é›†
3. æ”¯æŒå‘Šè­¦æœºåˆ¶

## è´¡çŒ®æŒ‡å—

1. éµå¾ªé¡¹ç›®çš„ä»£ç è§„èŒƒ
2. æ·»åŠ å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹
3. æ›´æ–°ç›¸å…³æ–‡æ¡£
4. æäº¤ Pull Request

## è®¸å¯è¯

æœ¬é¡¹ç›®éµå¾ªé¡¹ç›®æ ¹ç›®å½•çš„ LICENSE æ–‡ä»¶ã€‚ 