# .clang-format - Nut Engine Code Style
# 基于 Unreal Engine 代码风格的 clang-format 配置
# https://docs.unrealengine.com/5.0/en-US/epic-cplusplus-coding-standard/

---
Language: Cpp
BasedOnStyle: LLVM

# 基本缩进和对齐
IndentWidth: 4
TabWidth: 4
UseTab: ForIndentation  # UE 使用 Tab 缩进
ColumnLimit: 120        # UE 建议的行长度

# 访问修饰符 - UE 风格
AccessModifierOffset: -4
IndentAccessModifiers: false
EmptyLineAfterAccessModifier: Never
EmptyLineBeforeAccessModifier: LogicalBlock

# 大括号样式 - UE 使用 Allman 风格
BreakBeforeBraces: Custom
BraceWrapping:
  AfterCaseLabel: false
  AfterClass: true
  AfterControlStatement: Always
  AfterEnum: true
  AfterFunction: true
  AfterNamespace: true
  AfterStruct: true
  AfterUnion: true
  AfterExternBlock: true
  BeforeCatch: true
  BeforeElse: true
  BeforeLambdaBody: false
  BeforeWhile: false
  IndentBraces: false
  SplitEmptyFunction: false
  SplitEmptyRecord: false
  SplitEmptyNamespace: false

# 函数和方法格式化
AlwaysBreakAfterDefinitionReturnType: None
AlwaysBreakTemplateDeclarations: Yes
BinPackArguments: false    # UE 倾向于不打包参数
BinPackParameters: false   # UE 倾向于不打包参数
AllowAllArgumentsOnNextLine: true
AllowAllParametersOfDeclarationOnNextLine: true

# 控制语句 - UE 风格
AllowShortBlocksOnASingleLine: Never
AllowShortCaseLabelsOnASingleLine: false
AllowShortFunctionsOnASingleLine: None  # UE 不允许短函数在一行
AllowShortIfStatementsOnASingleLine: Never
AllowShortLambdasOnASingleLine: All
AllowShortLoopsOnASingleLine: false
AllowShortNamespacesOnASingleLine: false

# 构造函数和继承
BreakConstructorInitializers: BeforeColon
BreakInheritanceList: BeforeColon
ConstructorInitializerIndentWidth: 4
PackConstructorInitializers: Never

# 空格和换行
SpaceAfterCStyleCast: false
SpaceAfterLogicalNot: false
SpaceAfterTemplateKeyword: true
SpaceBeforeAssignmentOperators: true
SpaceBeforeCpp11BracedList: false
SpaceBeforeCtorInitializerColon: true
SpaceBeforeInheritanceColon: true
SpaceBeforeParens: ControlStatements
SpaceBeforeRangeBasedForLoopColon: true
SpaceBeforeSquareBrackets: false
SpaceInEmptyBlock: false
SpacesBeforeTrailingComments: 1
SpacesInAngles: Never
SpacesInContainerLiterals: true
SpacesInParens: Never
SpacesInSquareBrackets: false

# 指针和引用对齐 - UE 风格（左对齐 Type* Var）
PointerAlignment: Left
ReferenceAlignment: Left
DerivePointerAlignment: false

# 包含头文件排序 - UE 风格
SortIncludes: CaseSensitive
IncludeBlocks: Regroup
IncludeCategories:
  # 1. 生成的头文件（必须最后排序）
  - Regex: '^".*\.generate\.h"$'
    Priority: 1000
    SortPriority: 1000
  # 2. 主头文件（对应的 .h 文件）
  - Regex: '^".*\.h"$'
    Priority: 1
    SortPriority: 0
  # 3. Engine 和 NLib 相关头文件
  - Regex: '^"(Engine|NLib|Nut)/.*\.h"$'
    Priority: 2
    SortPriority: 0
  # 4. ThirdParty 头文件
  - Regex: '^"ThirdParty/.*"$'
    Priority: 4
    SortPriority: 0
  # 5. C++ 标准库
  - Regex: '^<[^/]+>$'
    Priority: 5
    SortPriority: 0
  # 6. 系统头文件
  - Regex: '^<.*>$'
    Priority: 6
    SortPriority: 0

# 注释
AlignTrailingComments:
  Kind: Always
  OverEmptyLines: 0
ReflowComments: true
CommentPragmas: '^ IWYU pragma:'

# 宏和预处理器
IndentPPDirectives: None
MacroBlockBegin: ''
MacroBlockEnd: ''

# 对齐
AlignAfterOpenBracket: Align
AlignConsecutiveAssignments:
  Enabled: false
AlignConsecutiveDeclarations:
  Enabled: false
  AlignFunctionDeclarations: true
AlignConsecutiveMacros:
  Enabled: false
AlignEscapedNewlines: Right
AlignOperands: Align

# 换行和二元操作符
BreakBeforeBinaryOperators: None
BreakBeforeTernaryOperators: true
BreakStringLiterals: true
ContinuationIndentWidth: 4

# 数组和初始化列表
Cpp11BracedListStyle: true
BreakArrays: true

# 空行
KeepEmptyLines:
  AtStartOfBlock: false
  AtStartOfFile: true
  AtEndOfFile: false
MaxEmptyLinesToKeep: 2

# 命名空间
CompactNamespaces: false
FixNamespaceComments: true
NamespaceIndentation: None

# 特定于 UE/Nut 的宏处理
AttributeMacros:
  - __capability
  - FORCEINLINE
  - FORCENOINLINE
StatementMacros:
  - Q_UNUSED
  - QT_REQUIRE_VERSION
  - UCLASS
  - USTRUCT
  - UENUM
  - UFUNCTION
  - UPROPERTY
  - GENERATED_BODY
  - NCLASS
  - GENERATED_UCLASS_BODY
  - GENERATED_USTRUCT_BODY
ForEachMacros:
  - foreach
  - Q_FOREACH
  - BOOST_FOREACH
  - TRange
  - RANGE_FOR

# 其他 UE 特定设置
Standard: c++20
DisableFormat: false

# 惩罚设置（影响换行决策）
PenaltyBreakAssignment: 100
PenaltyBreakBeforeFirstCallParameter: 19
PenaltyBreakComment: 300
PenaltyBreakFirstLessLess: 120
PenaltyBreakString: 1000
PenaltyBreakTemplateDeclaration: 10
PenaltyExcessCharacter: 1000000
PenaltyReturnTypeOnItsOwnLine: 1000

# Lambda 和现代 C++ 特性
LambdaBodyIndentation: Signature
# AllowShortLambdasOnASingleLine: All
RequiresClausePosition: OwnLine

# 排序
SortUsingDeclarations: LexicographicNumeric

# 换行相关
BreakAfterAttributes: Leave
BreakBeforeConceptDeclarations: Always

# 其他格式设置
InsertBraces: false
InsertNewlineAtEOF: false
InsertTrailingCommas: None
RemoveBracesLLVM: false
RemoveSemicolon: false
